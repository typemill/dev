{% macro loop_over(navigation,chapnum) %}

    {% import _self as macros %}

    {% for element in navigation %}

		{% set depth = element.keyPathArray|length %}

        {% if element.activeParent %}
			<li class="{{ element.elementType }} level-{{ depth }} no-transition activeParent" data-id="{{ element.urlRelWoF }}" data-depth="{{ depth }}">
		{% elseif element.active %}
			<li class="{{ element.elementType }} level-{{ depth }} no-transition active" data-id="{{ element.urlRelWoF }}" data-depth="{{ depth }}">
		{% else %}
			<li class="{{ element.elementType }} level-{{ depth }} no-transition" data-id="{{ element.urlRelWoF }}" data-depth="{{ depth }}">
		{% endif %}
        
			{% if (element.elementType == 'folder') and (element.folderContent|length > 0) and (element.contains == 'pages') %}	
				<div class="folder-header flex justify-between">
					<a class="link dib w-100 relative fw7 pv2 pl3 pr1 indent-l-{{depth}} {% if element.active %} active{% else %} b--transparent{% endif %}" href="{{ element.urlAbs }}">{% if chapnum %}{{ element.chapter }}. {% endif %}{{ element.name }}</a>
				</div>
				{% if depth == 1 %}
					<div class="flyout">
		                <ul class="list pa0">
				            {{ macros.loop_over(element.folderContent, chapnum) }}
		                </ul>
		            </div>
		        {% else %}
	                <ul class="list pa0">
			            {{ macros.loop_over(element.folderContent, chapnum) }}
	                </ul>
		        {% endif %}	               
        	{% elseif (element.elementType == 'folder') %}
				<a class="link dib w-100 relative fw7 pv2 ph3 pr2 indent-l-{{depth}}" href="{{ element.urlAbs }}">{% if chapnum %}{{ element.chapter }}. {% endif %}{{ element.name }}</a>
        	{% else %}
				<a class="link dib w-100 relative fw3 pv2 ph3 pr2 indent-l-{{depth}}" href="{{ element.urlAbs }}">{% if chapnum %}{{ element.chapter }} {% endif %}{{ element.name }}</a>
        	{% endif %}
      	</li>
    {% endfor %}
{% endmacro %}

{% import _self as macros %}

<ul id="navigation" class="topnavigation list pa0 ma0 flex justify-start">
    {{ macros.loop_over(navigation, settings.themes.guide.chapnum ) }}
</ul>